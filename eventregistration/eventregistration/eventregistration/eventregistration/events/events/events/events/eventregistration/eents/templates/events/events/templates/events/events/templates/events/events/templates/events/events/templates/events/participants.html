<!DOCTYPE html>
<html>
<head>
    <title>Participants</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        input { padding: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <h2>Participants for: {{ event.name }}</h2>
    
    <!-- FLAW 4: SQL Injection via search parameter -->
    <form method="get">
        <input type="text" name="search" placeholder="Search comments..." value="{{ request.GET.search }}">
        <button type="submit">Search</button>
    </form>
    
    <table>
        <tr>
            <th>Username</th>
            <th>Registered At</th>
            <th>Comments</th>
        </tr>
        {% for reg in registrations %}
        <tr>
            <td>{{ reg.user.username }}</td>
            <td>{{ reg.registered_at }}</td>
            <td>{{ reg.comments|safe }}</td> <!-- FLAW 5: XSS via safe filter -->
        </tr>
        {% endfor %}
    </table>
    
    <!-- FIX 5 (Additional): Remove |safe filter to prevent XSS -->
    <!-- Change {{ reg.comments|safe }} to {{ reg.comments }} -->
    <!-- Django auto-escapes by default, preventing XSS attacks -->
    <!-- Source: https://docs.djangoproject.com/en/4.2/ref/templates/language/#automatic-html-escaping -->
    
    <p><a href="{% url 'index' %}">Back to Events</a></p>
</body>
</html>
